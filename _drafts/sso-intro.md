---
title: "SSO Introduction"
date: 2019-03-25 10:41:00
lang: en
ref: sso-intro

---
SSO: Single Sing-on

JWT

JWT: JSON Web Token

JWT has three separated(.) parts

xxxxx.yyyyy.zzzzz

Header (xxxxx)
Payload (yyyyy)
Signature (zzzzz)

The codes are generated by the HMAC algo(or RSA or ECDSA keys).
HMAC algorithm: Hash-Based Message Authentication Code

Any cryptographic hash function(Ex SHA-256 or SHA-3) can be used on the calculation of HMAC.

Info on RSA or ECDSA keys:
https://security.stackexchange.com/questions/178958/what-are-the-differences-between-the-rsa-dsa-and-ecdsa-keys-that-ssh-uses?noredirect=1&lq=1

<h2>OAuth</h2>

OAuth:Omni-Authentication
Oauth2: Industry standard protocol for authorization

URI = Protocol + URL + URN

<h3>Web server apps flow</h3>
 <h4>Authorization</h4>

 1. User click on Login and transfer the following data through an http request params

 <pre>
  <code>
   https://authorization-server.com/auth?response_type=code&
    client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&scope=photos&state=1234zyx
  </code></pre>

 response_type=code - Indicates that your server expects to receive an authorization code

 client_id - The client ID you received when you first created the application

 redirect_uri - Indicates the URI to return the user to after authorization is complete

 scope - One or more scope values indicating which parts of the user's account you wish to access

 state - A random string generated by your application, which you'll verify later

 1. Then the user must allow the the application to connect to his account. If he allows, the service redirects the user to the redirect_uri with two params:

 <pre>
  <code>
   https://example-app.com/cb?code=AUTH_CODE_HERE&state=1234zyx
  </code></pre>

 code - the serer returns the authorization code in the query string

 state - the same state string previously passed. This can be stored as a cookie or session.

 <h4>Token Exchange</h4>

 1. User server exchange auth code for access token on authorization-server

 <pre>
  <code>
   POST https://api.authorization-server.com/token
     grant_type=authorization_code&
     code=AUTH_CODE_HERE&
     redirect_uri=REDIRECT_URI&
     client_id=CLIENT_ID&
     client_secret=CLIENT_SECRET
 </code></pre>

 grant_type=authorization_code - The grant type for this flow is authorization_code

 code=AUTH_CODE_HERE - This is the code you received in the query string

 redirect_uri=REDIRECT_URI - Must be identical to the redirect URI provided in the original link

 client_id=CLIENT_ID - The client ID you received when you first created the application

 client_secret=CLIENT_SECRET - Since this request is made from server-side code, the secret is included

 1. the auth-server replies with an access token and expiration time

 <pre>
  <code>
  {
   "access_token":"RsT5OjbzRn430zqMLgV3Ia",
   "expires_in":3600
  }
 </code></pre>

 <h3>Making Authenticated Requests</h3>

 Now that the user have an access token he can make HTTPS requests to the API. Ex:

 <pre>
  <code>
   curl -H "Authorization: Bearer RsT5OjbzRn430zqMLgV3Ia" \
   https://api.authorization-server.com/1/me
 </code></pre>

 <h4>Resources</h4>
 - Really helpful blog post https://aaronparecki.com/oauth-2-simplified/
 - https://oauth.net/2/
 - https://www.oauth.com/
 - Paper  https://tools.ietf.org/html/rfc7636
 - Paper https://tools.ietf.org/html/draft-ietf-oauth-native-apps-07
 - Ruby gem OAuth2 https://github.com/oauth-xx/oauth2
